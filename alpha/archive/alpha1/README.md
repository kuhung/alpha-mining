# Alpha#1 策略模拟与计算

本项目演示了如何根据给定的 Alpha#1 公式生成模拟金融数据、计算 Alpha 因子，并对结果进行分析。

## Alpha#1 公式

Alpha#1 的计算公式如下：

```
(rank(Ts_ArgMax(SignedPower(((returns < 0) ? stddev(returns, 20) : close), 2.), 5)) - 0.5)
```

其中：

* `returns`: 资产的日回报率。
* `close`: 资产的日收盘价。
* `stddev(series, N)`: 计算时间序列 `series` 在过去 `N` 天的滚动标准差。
* `SignedPower(series, A)`: 计算 `sign(series) * (abs(series) ** A)`。
* `Ts_ArgMax(series, N)`: 在给定的 `series` 中，返回过去 `N` 天内使其达到最大值的那个 `series` 的值。例如，如果过去5天 `SignedPower` 的值分别是 `[10, -5, 12, 8, 9]`，则 `Ts_ArgMax` 返回 `12`。
* `rank(series)`: 计算 `series` 中每个值在当日所有资产间的排序百分比（0到1之间）。值越大，排名越高。

## 项目结构

```
alpha-mining/
├── generate_mock_data.py   # 脚本：生成模拟金融数据
├── alpha_calculator.py     # 脚本：根据公式计算 Alpha#1
├── mock_data.csv           # 生成的模拟数据文件
├── alpha1_results.csv      # 计算得到的 Alpha#1 结果文件
└── README.md               # 本说明文档
```

## 使用步骤

### 1. 环境准备

确保您的 Python 环境中安装了 `pandas` 和 `numpy` 库。如果未安装，可以通过 pip 安装：

```bash
pip install pandas numpy
```

### 2. 生成模拟数据

运行 `generate_mock_data.py` 脚本以生成模拟的收盘价和回报率数据。此脚本将创建一个名为 `mock_data.csv` 的文件。

```bash
python generate_mock_data.py
```

该脚本默认生成5只资产100天的数据。

### 3. 计算 Alpha#1 因子

生成模拟数据后，运行 `alpha_calculator.py` 脚本来计算 Alpha#1 因子。该脚本会读取 `mock_data.csv`，执行公式中的计算，并将结果保存到 `alpha1_results.csv`。

```bash
python alpha_calculator.py
```

脚本执行完毕后，会在终端打印出结果文件的前5行、后5行以及 Alpha#1 值的描述性统计信息。

## Alpha#1 策略解读

该 Alpha 策略试图捕捉基于特定条件下的资产表现强度。

为了更好地理解计算过程，我们假设有以下模拟数据片段（来自 `mock_data.csv` 的对应部分，并结合 `alpha1_results.csv` 的数据）：

| date       | asset_id | close   | returns    |
|------------|----------|---------|------------|
| 2025-01-20 | asset_1  | 102.4   |  0.0261    |
| 2025-01-21 | asset_1  | 102.4   |  0.0       |
| 2025-01-22 | asset_1  | 103.8   |  0.0137    |
| 2025-01-23 | asset_1  | 101.8   | -0.0193    |
| 2025-01-24 | asset_1  | 101.9   |  0.001     |
| 2025-01-25 | asset_1  | 101.3   | -0.0059    |

并且，假设在 `2025-01-25`，`asset_1` 过去20天的回报率标准差（`stddev(returns, 20)`）计算结果为 `0.015` (这是一个示例值，实际计算会动态获取)。

下面是 Alpha#1 计算的详细步骤：

1.  **条件价值 (`(returns < 0) ? stddev(returns, 20) : close`)**:

    *   如果资产的当日回报率为负（即下跌），则使用其过去20天的回报率标准差（波动率）作为基础值。
    *   如果资产的当日回报率为正或零（即上涨或持平），则使用其当日收盘价作为基础值。
        这个步骤的含义是，对于下跌的股票，我们关注其波动性；对于上涨或持平的股票，我们关注其价格水平。

    *示例 (asset_1, 2025-01-25)*:
    `returns` 为 `-0.0059` (小于0)，所以我们使用 `stddev(returns, 20)` 的值，即假设的 `0.015`。

    *示例 (asset_1, 2025-01-24)*:
    `returns` 为 `0.001` (大于0)，所以我们使用 `close` 的值，即 `101.9`。

2.  **符号幂 (`SignedPower(..., 2.)`)**:

    *   将上述条件价值进行平方处理，同时保留其原始符号。这会放大绝对值较大的值，无论是正还是负。

    *示例 (asset_1, 2025-01-25)*:
    条件价值是 `0.015`。`SignedPower(0.015, 2.)` = `sign(0.015) * (abs(0.015) ** 2)` = `1 * (0.015 ** 2)` = `0.000225`。

    *示例 (asset_1, 2025-01-24)*:
    条件价值是 `101.9`。`SignedPower(101.9, 2.)` = `sign(101.9) * (abs(101.9) ** 2)` = `1 * (101.9 ** 2)` = `10383.61`。

3.  **时间序列最大值 (`Ts_ArgMax(..., 5)`)**:

    *   对于每只资产，观察其过去5天的 `SignedPower` 值，并找出这5天中的最大值。
    *   这个操作关注的是近期（5天内）表现最强的信号（经过 `SignedPower` 转换后的值）。

    *示例 (asset_1, 2025-01-25)*:
    假设 `asset_1` 在 `2025-01-21` 到 `2025-01-25` 这5天的 `SignedPower` 值，结合上面计算的 `2025-01-24` 和 `2025-01-25` 的值，可能如下（其余为假设值）：
    `[SP(01-21), SP(01-22), SP(01-23), 10383.61, 0.000225]` (分别对应 01-21 到 01-25 日)
    如果 `SP(01-21)` 到 `SP(01-23)` 的值均小于 `10383.61`，
    则 `Ts_ArgMax` 在 `2025-01-25` 这一天会返回 `10383.61`。

4.  **排名 (`rank(...)`)**:

    *   在每个交易日，将所有资产的 `Ts_ArgMax` 值进行横向比较，并计算其百分位排名。排名越高，说明该资产在当天的信号值越突出。

    *示例 (2025-01-25)*:
    假设 `asset_1` 当天通过上述步骤计算得到的 `Ts_ArgMax` 值为 `10383.61`。
    再假设当天其他4只资产计算得到的 `Ts_ArgMax` 值分别为（仅为示意）：
    asset_2: `12000.0`
    asset_3: `10000.0`
    asset_4: `10500.0`
    asset_5: `11000.0`
    进行排名（从小到大排序后，`asset_1` 的 `10383.61` 位于 `10000.0` 和 `10500.0` 之间，但低于 `10500.0`，`11000.0`，`12000.0`）。
    如果 `asset_1` 的 `rank` 值为 `0.8` (对应 `alpha1_results.csv` 中 `asset_1` 在 `2025-01-25` 的 `alpha1` 值为 `0.3`，因此 `rank = 0.3 + 0.5 = 0.8`)。

    （注意：实际 `rank` 的计算方式在 `alpha_calculator.py` 中使用的是 `rank(pct=True)`。为简化示例，此处直接使用由最终 alpha 值反推的 rank。）

5.  **中心化 (`... - 0.5`)**:

    *   将排名值减去0.5，使得 Alpha 值的范围大致在 -0.5 到 0.5 之间。正值表示高于平均水平，负值表示低于平均水平。

    *示例 (asset_1, 2025-01-25)*:
    `rank` 值为 `0.8`。Alpha#1 = `0.8 - 0.5` = `0.3`。
    这与 `alpha1_results.csv` 中 `asset_1` 在 `2025-01-25` 的 `alpha1` 值 `0.3` 相符。

总的来说，Alpha#1 倾向于选择那些在近期（5日内）表现出强劲\"条件价值\"（考虑了下跌时的波动率或上涨时的价格水平，并进行了平方放大）的资产。它是一个结合了动量（通过 `Ts_ArgMax`）和相对强度（通过 `rank`）的因子。

如需帮助或有建议，欢迎交流！
