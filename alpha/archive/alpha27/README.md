# Alpha#27 - 成交量与均价排名相关性趋势因子

## 因子公式

`((0.5 < rank((sum(correlation(rank(volume), rank(vwap), 6), 2) / 2.0))) ? (-1 * 1) : 1)`

## 因子逻辑

Alpha#27 通过分析成交量和成交均价的排名相关性来判断市场趋势的强弱。具体步骤：

1. 计算成交量和VWAP的排名
2. 计算两个排名序列的6日相关系数
3. 对相关系数进行2日求和并取平均
4. 对结果进行排名，与0.5比较
5. 生成最终信号：大于0.5返回-1，否则返回1

这个因子主要用于判断市场趋势的持续性和转折可能。

## 项目结构

```
alpha-mining/
├── data/
│   ├── generate_mock_data.py  # 脚本：生成模拟金融数据
│   └── mock_data.csv          # 生成的模拟数据文件
├── alpha/alpha27/
│   ├── alpha_calculator.py    # 脚本：根据公式计算 Alpha#27
│   ├── alpha27_results.csv    # 计算得到的 Alpha#27 结果文件
│   ├── README.md              # 本说明文档
│   └── cast.md                # Alpha#27 策略总结
...
```

## 使用步骤

### 1. 环境准备

确保您的 Python 环境中安装了 `pandas` 和 `numpy` 库：

```bash
pip install pandas numpy
```

### 2. 数据准备

本 Alpha 依赖于 `date`, `asset_id`, `volume`, `vwap` 数据。这些数据应存在于 `../../data/mock_data.csv` 文件中。

### 3. 计算 Alpha#27 因子

进入 `alpha/alpha27` 目录并运行 `alpha_calculator.py` 脚本：

```bash
python alpha_calculator.py
```

## Alpha#27 策略解读与计算示例

以下示例使用 `alpha27_results.csv` 中的实际数据来展示计算过程。我们以 `2025-01-07` 的数据为例 (假设 asset_id 为 asset_1):

**背景数据**:
- 日期: `2025-01-07`
- 资产: `asset_1`
- 成交量 (`volume`): `2713351`
- 成交量加权平均价 (`vwap`): `101.6`
- 最终Alpha值 (`alpha27`): `-1.0`

**计算步骤**:

1.  **计算成交量排名 (`rank(volume)`)**:
    *   对当日所有资产的成交量进行横向比较，并计算其百分比排名。例如，`asset_1` 的成交量 `2713351` 在当日所有资产中可能处于较高水平，得到一个较高的排名值（如0.8）。

2.  **计算VWAP排名 (`rank(vwap)`)**:
    *   对当日所有资产的VWAP进行横向比较，并计算其百分比排名。例如，`asset_1` 的VWAP `101.6` 在当日所有资产中也可能处于较高水平，得到一个较高的排名值（如0.75）。

3.  **计算排名序列的6日相关系数 (`correlation(rank(volume), rank(vwap), 6)`)**:
    *   对于 `asset_1`，获取过去6日的成交量排名序列和VWAP排名序列。
    *   计算这两个时间序列之间的相关系数。

4.  **相关系数的2日加总并平均 (`sum(correlation(...), 2) / 2.0`)**:
    *   取步骤3得到的相关系数序列，计算其最近2日的和，然后除以2，得到一个平滑后的相关性指标。

5.  **对平滑后的相关性指标进行排名 (`rank((sum(...) / 2.0))`)**:
    *   将步骤4中计算得到的平滑相关性指标，在当日所有资产间进行横向百分比排名。
    *   假设 `asset_1` 在此步骤的排名值为 `0.6`。

6.  **条件判断并生成信号**:
    *   判断 `0.5 < rank_value` (即 `0.5 < 0.6`)。此条件为真。
    *   因为条件为真，所以 Alpha#27 的值为 `-1`。

这个示例展示了一个典型的信号生成过程：
-   成交量和VWAP的排名，以及它们之间的相关性变化，共同决定了最终的因子值。
-   当一系列计算后的最终排名超过0.5时，因子输出-1，可能表示一种趋势反转或特定市场状态的信号。

## 数据需求

- `date`: 交易日期 (YYYY-MM-DD)
- `asset_id`: 资产ID
- `volume`: 成交量
- `vwap`: 成交量加权平均价格

## 输出格式

输出的 CSV 文件 (`alpha27_results.csv`) 包含以下列：

- `date`: 交易日期
- `volume`: 成交量（原始数据）
- `vwap`: 成交量加权平均价格（原始数据）
- `alpha27`: 计算得到的 Alpha#27 值（-1 或 1），保留两位有效数字

## 应用场景

1. 市场趋势强度判断
2. 趋势持续性预测
3. 交易量价关系分析
4. 市场情绪监测

## 优势

1. 信号明确（1或-1）
2. 考虑了量价关系的动态变化
3. 通过排名消除数值差异影响
4. 适合趋势跟踪策略

## 局限性

1. 需要足够的历史数据（至少6日）
2. 可能错过快速反转机会
3. 在震荡市场中可能频繁变换信号
4. 依赖VWAP的准确计算

## 风险提示

1. 信号切换可能带来过高换手率
2. 在高波动期可能产生误判
3. 需要考虑交易成本的影响
4. 建议配合其他指标使用

## 注意事项

1. 参数设置（6日和2日窗口）可能需要调整
2. 建议设置信号过滤机制
3. 考虑加入止损策略
4. 定期评估因子有效性 