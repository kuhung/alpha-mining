# Alpha#26 - 成交量与价格高点排名相关性因子

## 因子公式

`(-1 * ts_max(correlation(ts_rank(volume, 5), ts_rank(high, 5), 5), 3))`

## 因子逻辑

Alpha#26 通过分析成交量和最高价的排名相关性来识别市场异常。具体步骤：

1. 分别计算成交量和最高价的5日排名
2. 计算这两个排名序列的5日相关系数
3. 取相关系数的3日最大值
4. 对结果取负值

这个因子主要用于捕捉价格和成交量的背离现象，帮助识别潜在的市场转折点。

## 项目结构

```
alpha-mining/
├── data/
│   ├── generate_mock_data.py  # 脚本：生成模拟金融数据
│   └── mock_data.csv          # 生成的模拟数据文件
├── alpha/alpha26/
│   ├── alpha_calculator.py    # 脚本：根据公式计算 Alpha#26
│   ├── alpha26_results.csv    # 计算得到的 Alpha#26 结果文件
│   ├── README.md              # 本说明文档
│   └── cast.md                # Alpha#26 策略总结
...
```

## 使用步骤

### 1. 环境准备

确保您的 Python 环境中安装了 `pandas` 和 `numpy` 库：

```bash
pip install pandas numpy
```

### 2. 数据准备

本 Alpha 依赖于 `date`, `asset_id`, `high`, `volume` 数据。这些数据应存在于 `../../data/mock_data.csv` 文件中。

### 3. 计算 Alpha#26 因子

进入 `alpha/alpha26` 目录并运行 `alpha_calculator.py` 脚本：

```bash
python alpha_calculator.py
```

## Alpha#26 策略解读与计算示例

以下示例使用 `alpha26_results.csv` 中的实际数据来展示计算过程。我们以 `2025-01-11` 的数据为例 (假设 asset_id 为 asset_1):

**背景数据**:
- 日期: `2025-01-11`
- 资产: `asset_1`
- 成交量 (`volume`): `539969` (示例，非真实计算依赖)
- 最高价 (`high`): `99.71` (示例，非真实计算依赖)
- 最终Alpha值 (`alpha26`): `-0.7`

**计算步骤**:

1.  **计算成交量5日排名 (`ts_rank(volume, 5)`)**:
    *   取最近5日的成交量数据，计算当日成交量在过去5日内的百分比排名。
    *   例如，若 `volume` 在 `asset_1` 于 `2025-01-07` 至 `2025-01-11` 的数据中排名较低，则得到一个较小的百分比值。

2.  **计算最高价5日排名 (`ts_rank(high, 5)`)**:
    *   取最近5日的最高价数据，计算当日最高价在过去5日内的百分比排名。
    *   例如，若 `high` 在 `asset_1` 于 `2025-01-07` 至 `2025-01-11` 的数据中排名也较低，则得到一个较小的百分比值。

3.  **计算排名序列的5日相关系数 (`correlation(ts_rank(volume, 5), ts_rank(high, 5), 5)`)**:
    *   将步骤1和2得到的两个排名序列，计算它们在过去5日的相关系数。
    *   如果成交量排名和最高价排名同步变化（例如，成交量排名高时，最高价排名也高），相关系数趋向于1。如果反向变化，趋向于-1。

4.  **取相关系数的3日最大值 (`ts_max(correlation(...), 3)`)**:
    *   取步骤3计算得到的相关系数序列，在过去3日内的最大值。
    *   例如，若过去三天的相关系数分别为 `0.6`, `0.7`, `0.5`，则最大值为 `0.7`。

5.  **取负值**:
    *   `-1 * ts_max_correlation = -1 * 0.7 = -0.7`

这个示例展示了一个典型的信号生成过程：
-   成交量和最高价在近期排名不高，并且它们之间的相关性在近期达到了一个较高的正值。
-   因子最终取这个相关性最大值的负数，得到 `-0.7`。
-   这可能表示近期价量关系的一种特定模式，具体解释需结合更多市场背景。

## 数据需求

- `date`: 交易日期 (YYYY-MM-DD)
- `asset_id`: 资产ID
- `volume`: 成交量
- `high`: 最高价

## 输出格式

输出的 CSV 文件 (`alpha26_results.csv`) 包含以下列：

- `date`: 交易日期
- `volume`: 成交量（原始数据）
- `high`: 最高价（原始数据）
- `alpha26`: 计算得到的 Alpha#26 值，保留两位有效数字

## 应用场景

1. 市场趋势转折点预测
2. 价量背离信号识别
3. 市场异常行为监测
4. 风险控制系统的补充指标

## 优势

1. 通过排名降低异常值影响
2. 多重时间窗口提供更稳定的信号
3. 价量结合提供更全面的市场视角
4. 适用于不同市场环境

## 局限性

1. 需要足够的历史数据（至少5日）
2. 排名计算可能存在滞后性
3. 在剧烈波动市场中可能产生误判
4. 计算复杂度相对较高

## 风险提示

1. 因子信号可能存在滞后性
2. 不同市场环境下表现不一
3. 建议与其他技术指标配合使用
4. 需要定期评估因子有效性

## 注意事项

1. 参数设置（5日和3日窗口）可能需要根据实际情况调整
2. 建议结合基本面分析使用
3. 在实盘中需要考虑交易成本
4. 适当设置止损止盈策略 