# Alpha#4 策略模拟与计算

本项目演示了如何根据给定的 Alpha#4 公式生成模拟金融数据、计算 Alpha 因子，并对结果进行分析。

## Alpha#4 公式

Alpha#4 的计算公式如下：

```
(-1 * Ts_Rank(rank(low), 9))
```

其中：

* `low`: 资产的日最低价。
* `rank(series)`: 计算 `series` 中每个值在当日所有资产间的排序百分比（0到1之间）。值越大，排名越高。
* `Ts_Rank(series, N)`: 计算 `series` 在过去 `N` 天的时间序列排名。返回当前值在过去N天中的排名百分比。
* `(-1 *)`: 对结果取负值，实现反向逻辑。

## 项目结构

```
alpha-mining/
├── data/
│   ├── generate_mock_data.py  # 脚本：生成模拟金融数据（包含high, low字段）
│   └── mock_data.csv          # 生成的模拟数据文件
├── alpha/alpha4/
│   ├── alpha_calculator.py    # 脚本：根据公式计算 Alpha#4
│   ├── alpha4_results.csv     # 计算得到的 Alpha#4 结果文件
│   ├── README.md              # 本说明文档
│   └── cast.md                # Alpha#4 策略总结
```

## 使用步骤

### 1. 环境准备

确保您的 Python 环境中安装了 `pandas` 和 `numpy` 库。如果未安装，可以通过 pip 安装：

```bash
pip install pandas numpy
```

### 2. 生成模拟数据

如果数据文件不存在或需要更新，运行 `data/generate_mock_data.py` 脚本以生成包含high、low字段的模拟数据：

```bash
cd data
python generate_mock_data.py
cd ..
```

该脚本默认生成5只资产100天的数据，包含open、high、low、close、volume和returns字段。

### 3. 计算 Alpha#4 因子

生成模拟数据后，运行 `alpha_calculator.py` 脚本来计算 Alpha#4 因子。该脚本会读取 `data/mock_data.csv`，执行公式中的计算，并将结果保存到 `alpha4_results.csv`。

```bash
cd alpha/alpha4
python alpha_calculator.py
```

脚本执行完毕后，会在终端打印出结果文件的前5行、后5行以及 Alpha#4 值的描述性统计信息。

## Alpha#4 策略解读

Alpha#4 是一个**反向低价因子**，该策略试图捕捉低价股票的时间序列相对表现。

为了更好地理解计算过程，我们以实际生成的数据为例，展示 asset_1 在 2025-01-24 前后的计算过程：

### 实际数据示例

| date       | asset_id | low    | rank_low | ts_rank_value | alpha4 |
| ---------- | -------- | ------ | -------- | ------------- | ------ |
| 2025-01-16 | asset_1  | 98.35  | 0.4      | 0.28          | -0.28  |
| 2025-01-17 | asset_1  | 98.85  | 0.4      | 0.33          | -0.33  |
| 2025-01-18 | asset_1  | 100.46 | 0.4      | 0.39          | -0.39  |
| 2025-01-19 | asset_1  | 100.82 | 0.4      | 0.44          | -0.44  |
| 2025-01-20 | asset_1  | 100.23 | 0.4      | 0.44          | -0.44  |
| 2025-01-21 | asset_1  | 99.90  | 0.4      | 0.44          | -0.44  |
| 2025-01-22 | asset_1  | 101.29 | 0.4      | 0.44          | -0.44  |
| 2025-01-23 | asset_1  | 101.19 | 0.4      | 0.44          | -0.44  |
| 2025-01-24 | asset_1  | 101.37 | 0.4      | 0.50          | -0.50  |

### 计算步骤详解

#### 1. **截面排名 (`rank(low)`)**:

以 2025-01-24 为例，当天5只资产的最低价分别为：

- asset_1: 101.37 (排名: 0.4 - 第2名)
- asset_2: 94.01  (排名: 0.2 - 第1名，最低价)
- asset_3: 109.72 (排名: 1.0 - 第5名，最高价)
- asset_4: 101.94 (排名: 0.6 - 第3名)
- asset_5: 108.91 (排名: 0.8 - 第4名)

可以看出，asset_1 的低价水平在当天排第2位（rank_low = 0.4）。

#### 2. **时间序列排名 (`Ts_Rank(..., 9)`)**:

对于 asset_1 在 2025-01-24，我们观察其过去9天的 rank_low 值：
`[0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4]`

由于这9天中所有值都相等（都是0.4），当前值 0.4 在这9个值中的时间序列排名为：
- 排名计算：所有9个值都相等，所以排名为 (0 + 0.5 × 9) / 9 = 0.5
- Ts_Rank = 0.50

#### 3. **反向化 (`(-1 *)`)**:

Alpha#4 = -1 × 0.50 = **-0.50**

### 特殊情况示例

从数据中我们还可以看到一些有趣的案例：

**案例1：2025-01-25 的 asset_1**
- low: 103.04, rank_low: 0.6 (排名上升)
- ts_rank_value: 0.94 (在过去9天中排名很高)
- alpha4: -0.94 (强烈的反向信号)

**案例2：asset_2 的稳定模式**
- asset_2 在很长时间内 rank_low 都保持在 0.2 (总是最低价)
- ts_rank_value 稳定在 0.5
- alpha4 稳定在 -0.5

## 策略含义

Alpha#4 的核心逻辑是：

1. **低价偏好的反向**: 传统上，低价股票可能被认为具有价值或反弹潜力。但Alpha#4采用反向逻辑。

2. **时间序列相对性**: 不仅考虑当前的低价水平，还考虑这一水平在过去9天中的相对位置。

3. **均值回归假设**: 如果一只股票的低价在过去9天中排名相对较高（即相对高价），Alpha#4给出负信号，暗示可能的价格回调。

4. **短期动量反转**: 9天的时间窗口捕捉短期价格动量，并基于反转逻辑进行交易。

### 实际结果统计

基于生成的500个观测值：
- **平均值**: -0.4963 (整体偏向负值)
- **标准差**: 0.1921 (波动适中)
- **范围**: -0.9444 到 -0.0556 (全部为负值，符合反向逻辑)
- **分布**: 25%分位数为-0.5556，75%分位数为-0.4444

该策略适用于：
- 寻找短期过度表现的股票进行反向操作
- 基于价格水平的相对变化进行交易决策
- 利用股票价格的短期均值回归特性

## 风险提示

- Alpha#4 是基于历史价格模式的统计策略，不保证未来表现
- 策略的有效性可能随市场环境变化而变化
- 建议与其他因子结合使用，构建多因子投资组合
- 请注意交易成本和市场流动性对实际表现的影响

如需帮助或有建议，欢迎交流！
