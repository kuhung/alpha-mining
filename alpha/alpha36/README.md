# Alpha#36: 多因子动量与价值策略

## 因子定义

```
(((((2.21 * rank(correlation((close - open), delay(volume, 1), 15))) + (0.7 * rank((open - close)))) + (0.73 * rank(Ts_Rank(delay((-1 * returns), 6), 5)))) + rank(abs(correlation(vwap, adv20, 6)))) + (0.6 * rank((((sum(close, 200) / 200) - open) * (close - open)))))
```

## 计算逻辑

该因子是一个复杂的多因子模型，结合了价格动量、成交量、价值和波动性指标，旨在识别具有特定行为模式的资产。

1.  **`term1: 2.21 * rank(correlation((close - open), delay(volume, 1), 15))`**
    *   `close - open`: 当日日内价格变动，反映日内动量。
    *   `delay(volume, 1)`: 昨日成交量。
    *   `correlation(..., 15)`: 计算过去15天日内价格变动与昨日成交量的相关性。这可能用于捕捉"价涨量增"或"价跌量缩"等模式。
    *   `rank(...)`: 对该相关性进行截面排名。
    *   `2.21 * ...`: 给予该项较高的权重。

2.  **`term2: 0.7 * rank(open - close)`**
    *   `open - close`: 日内价格反转信号（与 term1 中的 `close - open` 相反）。
    *   `rank(...)`: 对该信号进行截面排名。
    *   `0.7 * ...`: 给予该项一个权重。

3.  **`term3: 0.73 * rank(Ts_Rank(delay((-1 * returns), 6), 5))`**
    *   `delay((-1 * returns), 6)`: 6天前回报率的负值。
    *   `Ts_Rank(..., 5)`: 在过去5天的时间序列中对上述值进行排名。这捕捉了近期（6天前至10天前）的历史回报表现。
    *   `rank(...)`: 对该时间序列排名进行截面排名。
    *   `0.73 * ...`: 给予该项一个权重。

4.  **`term4: rank(abs(correlation(vwap, adv20, 6)))`**
    *   `adv20`: 过去20天的平均日成交额。
    *   `correlation(vwap, adv20, 6)`: 计算过去6天VWAP（成交量加权平均价）与20日平均成交额的相关性。这衡量了价格（VWAP）与流动性变化的关联强度。
    *   `abs(...)`: 取相关性的绝对值，关注其强度而非方向。
    *   `rank(...)`: 对该强度进行截面排名。

5.  **`term5: 0.6 * rank((((sum(close, 200) / 200) - open) * (close - open)))`**
    *   `sum(close, 200) / 200`: 过去200天的移动平均收盘价，一个长期价值基准。
    *   `( ... - open)`: 当日开盘价与长期价值基准的偏离。
    *   `(close - open)`: 当日日内动量。
    *   两者相乘，形成一个交互项，可能用于识别开盘价偏离长期价值后，日内走势是回归还是延续。
    *   `rank(...)`: 对该交互项进行截面排名。
    *   `0.6 * ...`: 给予该项一个权重。

6.  **最终因子值**:
    *   将上述五项的结果加权求和，得到最终的 Alpha#36 值。

## 因子数值范围

`Alpha#36` 的理论数值区间为 `[0, 5.24]`。

该因子由五个加权项组成，每个项在截面排名后都归一化到 `[0, 1]` 的范围。因此，每个项的取值范围为：
*   **`term1`**: `2.21 * rank(...)`，范围 `[0, 2.21 * 1]` 即 `[0, 2.21]`。
*   **`term2`**: `0.7 * rank(...)`，范围 `[0, 0.7 * 1]` 即 `[0, 0.7]`。
*   **`term3`**: `0.73 * rank(...)`，范围 `[0, 0.73 * 1]` 即 `[0, 0.73]`。
*   **`term4`**: `rank(abs(correlation(...)))`，范围 `[0, 1]`。
*   **`term5`**: `0.6 * rank(...)`，范围 `[0, 0.6 * 1]` 即 `[0, 0.6]`。

将这些项的最大值相加，可以得到最终 Alpha 值的最大理论范围：`2.21 + 0.7 + 0.73 + 1 + 0.6 = 5.24`。因此，理论上 `Alpha#36` 的值介于 `[0, 5.24]` 之间。

## 策略解读与计算示例

为了更好地理解 Alpha#36 的计算逻辑和数值特性，我们假设在某个交易日，对于某个资产，各分量经过截面排名（归一化至[0,1]区间）或相关性计算后的值如下：

*   `rank(correlation((close - open), delay(volume, 1), 15))` = `0.50`
*   `rank((open - close))` = `0.30`
*   `rank(Ts_Rank(delay((-1 * returns), 6), 5))` = `0.70`
*   `rank(abs(correlation(vwap, adv20, 6)))` = `0.80`
*   `rank((((sum(close, 200) / 200) - open) * (close - open)))` = `0.60`

根据公式各部分计算：

1.  **`term1`**: `2.21 * 0.50 = 1.105`
2.  **`term2`**: `0.7 * 0.30 = 0.21`
3.  **`term3`**: `0.73 * 0.70 = 0.511`
4.  **`term4`**: `0.80`
5.  **`term5`**: `0.6 * 0.60 = 0.36`

因此：
`Alpha#36 = 1.105 + 0.21 + 0.511 + 0.80 + 0.36 = 2.986`

四舍五入到两位小数后，结果为 `2.99`。

这个例子展示了如何结合各个子项的贡献来计算最终的 Alpha#36 值，以及该因子如何反映多个市场驱动因素的综合效应。

## 项目结构

```
alpha-mining/
├── data/
│   ├── generate_mock_data.py
│   └── mock_data.csv
├── alpha/alpha36/
│   ├── alpha_calculator.py
│   ├── alpha36_results.csv
│   ├── README.md
│   └── cast.md
```

## 使用步骤

### 1. 环境准备
确保安装 `pandas` 和 `numpy`。
```bash
pip install pandas numpy
```

### 2. 检查模拟数据
本 Alpha 依赖于 `open`, `close`, `volume`, `returns`, `vwap`。脚本会自动计算 `adv20`。请确保 `data/mock_data.csv` 存在且包含所需列。

### 3. 计算 Alpha#36 因子
进入 `alpha/alpha36` 目录并运行 `alpha_calculator.py`。
```bash
python alpha_calculator.py
```
脚本将读取 `../../data/mock_data.csv`，计算 Alpha#36，并将结果保存到 `alpha36_results.csv`。

## 数据输入
*   `open`, `close`, `high`, `low`, `volume`: 标准日度数据。
*   `vwap`: 日度成交量加权平均价。
*   `returns`: 日度收盘-收盘回报率。
*   `adv20`: 过去20日平均成交额（将由脚本从 `close` 和 `volume` 计算得出）。

## 输出格式
输出的 CSV 文件 (`alpha36_results.csv`) 将包含原始数据列、关键中间计算列以及最终的 Alpha#36 值，所有数值列保留两位小数。
-   `date`, `asset_id`, ... (原始列)
-   `term1`, `term2`, `term3`, `term4`, `term5`: 五个主要部分的中间结果。
-   `alpha36`: 最终计算的 Alpha#36 值。

## 注意事项与风险提示
-   **NaN 值**: 大量的窗口计算（如15、200天）可能导致数据序列初始阶段出现较多 NaN 值。这是正常的计算特性，若需要更长期的有效数据，请考虑在 `data/generate_mock_data.py` 中生成更多历史数据。
-   **数据质量**: 输入数据的准确性和完整性至关重要。
-   **参数敏感性**: 因子表现可能对窗口大小（如15, 6, 5, 200）和权重（2.21, 0.7等）高度敏感。
-   **市场适用性**: 这是一个复杂的因子，在不同市场环境下表现可能迥异，务必进行充分的回测和验证。 