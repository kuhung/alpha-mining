# Alpha#28: 成交量最低价相关性与价格中枢偏离的标准化

本项目实现了 Alpha#28 因子的计算逻辑。

## 1. Alpha#28 公式

Alpha#28 的计算公式如下：

```
scale(((correlation(adv20, low, 5) + ((high + low) / 2)) - close))
```

**公式各项说明**:

*   `adv20`: 资产过去20日的平均成交量。
*   `low`: 资产的日最低价。
*   `high`: 资产的日最高价。
*   `close`: 资产的日收盘价。
*   `correlation(x, y, N)`: 计算序列 `x` 和 `y` 在过去 `N` 天窗口内的皮尔逊相关系数。
*   `scale(x)`: 对序列 `x` 进行横截面标准化处理，使其均值为0，标准差为1。

## 2. 核心逻辑

计算 Alpha#28 的主要步骤如下：

1.  **计算20日平均成交量 (`adv20`)**:
    *   对于每只资产，计算其过去20个交易日的平均成交量。
2.  **计算中间价格 (`mid_price`)**:
    *   对于每只资产，计算当日的最高价和最低价的平均值：`(high + low) / 2`。
3.  **计算相关系数 (`correlation`)**:
    *   对于每只资产，计算其过去5日的 `adv20` 序列与 `low` 序列之间的相关系数。
4.  **组合与差值**:
    *   将步骤3中得到的相关系数与步骤2中得到的中间价格相加。
    *   从上述结果中减去当日的收盘价 `close`。
5.  **横截面标准化 (`scale`)**:
    *   对步骤4中得到的结果，在每个交易日的所有资产间进行标准化处理，得到最终的 Alpha#28 值。

## 3. 策略解读

Alpha#28 试图捕捉市场中成交量、价格结构与收盘价之间的复杂关系。

*   **成交量与最低价的相关性 (`correlation(adv20, low, 5)`)**:
    *   正相关可能表示在成交量放大（或缩小）的同时，最低价也倾向于上升（或下降），这可能反映了市场对价格底部的确认或突破的强度。
    *   负相关则可能表示成交量变化与最低价变化方向相反，例如放量下跌或缩量上涨的底部试探。
*   **价格中枢与收盘价的偏离 (`((high + low) / 2) - close`)**:
    *   这部分衡量了收盘价相对于当日价格波动中枢的位置。
    *   如果收盘价远低于中枢价，可能表明当日存在一定的抛压或下跌动能。
    *   如果收盘价远高于中枢价，可能表明当日购买意愿较强或上涨动能。
*   **组合信号的意义**:
    *   因子将上述两部分信号（成交量-最低价相关性 和 价格中枢-收盘价偏离）结合起来。
    *   例如，一个较高的正相关系数（价量同向）加上一个较大的正偏离（收盘价高于中枢），可能会被因子视为一个强烈的看多或看空信号（具体方向需结合标准化后的符号判断）。
*   **标准化的作用 (`scale`)**:
    *   最后的 `scale` 操作将每日所有资产的因子值进行标准化，使其具有可比性，剔除了市场的整体波动影响，更关注个股的相对强弱。因子值为正，通常表示该股票在特定模式下表现相对较强；为负则表示相对较弱。

因子倾向于寻找那些在成交量与最低价表现出特定相关性，并且其日内价格行为（中间价与收盘价的关系）也符合一定模式的资产。

## 4. 项目结构

```text
alpha-mining/
├── data/
│   ├── generate_mock_data.py  # 脚本：生成模拟金融数据
│   └── mock_data.csv          # 生成的模拟数据文件
├── alpha/alpha28/
│   ├── alpha_calculator.py    # 脚本：根据公式计算 Alpha#28
│   ├── alpha28_results.csv    # 计算得到的 Alpha#28 结果文件
│   ├── README.md              # 本说明文档
│   └── cast.md                # Alpha#28 策略总结与转换说明
```

## 5. 使用步骤

### 5.1. 环境准备

确保您的 Python 环境中安装了 `pandas` 和 `numpy` 库。

```bash
pip install pandas numpy
```

### 5.2. 数据准备

运行 `alpha_calculator.py` 脚本需要 `mock_data.csv` 文件位于项目根目录下的 `data/` 目录中。该 CSV 文件必须至少包含以下列：

*   `date` (日期)
*   `asset_id` (资产ID)
*   `volume` (成交量)
*   `high` (最高价)
*   `low` (最低价)
*   `close` (收盘价)

如果数据文件不存在或需要更新，您可以运行 `data/generate_mock_data.py` (请确保该脚本会生成上述所有必需列)。

### 5.3. 计算 Alpha#28 因子

在 `alpha/alpha28/` 目录下，通过命令行运行 `alpha_calculator.py` 脚本：

```bash
python alpha_calculator.py
```

脚本将：
1.  读取 `../../data/mock_data.csv` 文件。
2.  计算 Alpha#28 因子。
3.  将结果（包括部分原始数据列和计算得到的 `alpha28` 列）保存到当前目录下的 `alpha28_results.csv` 文件中。
4.  在终端打印输出文件的前5行、后5行以及 `alpha28` 列的描述性统计信息，方便快速查阅。

## 6. Alpha#28 计算示例 (基于实际输出)

### 6.1. 数据快照

根据 `alpha28_results.csv` 的实际输出数据，我们选取 `asset_1` 在 `2025-01-05` 的数据作为示例：

| date       | asset_id | volume   | high   | low   | close | alpha28 |
|:-----------|:---------|:---------|:-------|:------|:------|:--------|
| 2025-01-05 | asset_1  | 1327947  | 100.58 | 98.69 | 100.5 | -0.61   |

*(注: `alpha28` 的值直接来自生成的结果文件。空值表示因计算窗口期不足等原因无法计算)*

### 6.2. 计算步骤详解 (以 asset_1, 2025-01-05 为例)

为计算 `asset_1` 在 `2025-01-05` 的 `alpha28` 值，`alpha_calculator.py` 脚本会执行以下操作：

*   **获取所需数据**：获取 `asset_1` 在 `2025-01-05` 及之前的 `volume`, `high`, `low`, `close` 数据。
*   **计算 `adv20`**: 计算 `asset_1` 截至 `2025-01-05` 的过去20日平均成交量。
*   **计算 `mid_price`**: `(100.58 + 98.69) / 2 = 99.635`。
*   **计算 `correlation(adv20, low, 5)`**: 计算 `asset_1` 截至 `2025-01-05` 的过去5日 `adv20` 序列与 `low` 序列的相关系数。
*   **计算组合与差值**: `correlation_value + mid_price - close_price`。
*   **横截面标准化 `scale`**: 将上述计算得到的未标准化值，与 `2025-01-05` 当日所有其他资产计算得到的未标准化值一起进行标准化（减去均值后除以标准差），得到最终的 `alpha28` 值为 `-0.61`。

**对 `alpha28 = -0.61` 的解读**: 
在 `2025-01-05` 这一天，`asset_1` 的 `alpha28` 值为 `-0.61`。负值表明，在综合考虑了其成交量与最低价的相关性、当日价格中枢以及收盘价之后，经过市场整体标准化比较，`asset_1` 当日的因子表现弱于市场平均水平。

## 7. 数据列说明

### 7.1. 输入数据 (`mock_data.csv`)

*   `date`: 交易日期 (例如 `YYYY-MM-DD` 格式)。
*   `asset_id`: 资产的唯一标识符 (例如 `asset_1`, `asset_2`)。
*   `volume`: 当日成交量 (数值型) - **核心计算列**。
*   `high`: 当日最高价 (数值型) - **核心计算列**。
*   `low`: 当日最低价 (数值型) - **核心计算列**。
*   `close`: 当日收盘价 (数值型) - **核心计算列**。
*   *(脚本会保留输入数据中的其他列如 `open`, `returns` 等到输出文件，以保持数据完整性，但它们不直接参与 Alpha#28 的核心计算)*

### 7.2. 输出数据 (`alpha28_results.csv`)

输出的 CSV 文件将包含原始数据中的所有列，并附加一列 `alpha28`：

*   `date`, `asset_id`, `volume`, `high`, `low`, `close` (及其他原始列)
*   `alpha28`: 计算得到的 Alpha#28 因子值 (浮点数，通常保留两位小数)。空值（NaN）表示因计算窗口期不足等原因无法计算。

## 8. 注意事项与风险提示

*   **数据窗口期**: 
    *   `adv20` 的计算使用了20日的滚动窗口 (脚本中 `min_periods=1` 允许在数据不足20天时也开始计算，但早期值可能不稳)。
    *   `correlation` 函数的窗口期为5日。
    *   因此，首个完整且相对稳定的 `alpha28` 值大约在数据序列的第20个有效交易日之后才能获得（因为 `adv20` 需要稳定）。根据 `alpha28_results.csv` 的示例输出，第一个非空值出现在 `2025-01-05`，这表明脚本实现中对窗口期有灵活处理。
*   **`scale` 函数的稳健性**: 标准化是按每个交易日进行的。如果某日只有一个资产，或者当日所有资产计算出的待标准化值的标准差为零，`scale` 操作可能会导致结果为 NaN 或无穷大。实际交易策略中需要对这类极端情况进行额外处理。
*   **因子有效性**: Alpha#28 是一个基于历史价量数据统计构建的因子，其历史表现不代表未来收益。在实际应用前，建议进行充分的回测验证，并考虑与其他因子结合使用以分散风险。
*   **数据质量**: 输入数据的准确性和完整性对因子计算结果至关重要。

---

如需帮助或对本文档及代码有任何建议，欢迎随时交流！ 