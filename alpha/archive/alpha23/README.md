# Alpha#23: 高价与移动平均的条件差分策略

## 描述

Alpha#23 的计算公式为：

```
(((sum(high, 20) / 20) < high) ? (-1 * delta(high, 2)) : 0)
```

该 Alpha 策略包含两个主要部分：

1. **条件判断部分**:
   * `sum(high, 20) / 20`: 计算最近20天的最高价移动平均
   * `< high`: 将当前最高价与20日移动平均比较

2. **信号生成部分**:
   * 当价格高于移动平均时：`-1 * delta(high, 2)` (最高价2日差分的负值)
   * 当价格不高于移动平均时：0 (不产生信号)

## 项目结构

```
alpha-mining/
├── data/
│   ├── generate_mock_data.py  # 脚本：生成模拟金融数据
│   └── mock_data.csv          # 生成的模拟数据文件
├── alpha/alpha23/
│   ├── alpha_calculator.py    # 脚本：根据公式计算 Alpha#23
│   ├── alpha23_results.csv    # 计算得到的 Alpha#23 结果文件
│   ├── README.md              # 本说明文档
│   └── cast.md               # Alpha#23 策略总结
...
```

## 使用步骤

### 1. 环境准备

确保您的 Python 环境中安装了 `pandas` 和 `numpy` 库：

```bash
pip install pandas numpy
```

### 2. 数据准备

本 Alpha 依赖于 `date`, `asset_id`, `high` 数据。这些数据应存在于 `../../data/mock_data.csv` 文件中。

### 3. 计算 Alpha#23 因子

进入 `alpha/alpha23` 目录并运行 `alpha_calculator.py` 脚本：

```bash
python alpha_calculator.py
```

## Alpha#23 策略解读与计算示例

以下示例使用 `alpha23_results.csv` 中的实际数据来展示计算过程。我们以 `asset_2` 在 `2025-01-20` 的数据为例：

**背景数据**:
- 日期: `2025-01-20`
- 资产ID: `asset_2`
- 当日最高价 (`high`): `103.45`
- 20日移动平均 (`high_ma_20`): `102.9635`
- 2日最高价差分 (`delta_high_2`): `1.28`
- 最终Alpha值 (`alpha23`): `-1.28`

**计算步骤**:

1. **计算20日移动平均**:
   * `high_ma_20 = 102.9635`
   * 这是过去20天（含当天）最高价的平均值

2. **条件判断**:
   * 当日最高价 `103.45` > 20日移动平均 `102.9635`
   * 条件成立，继续计算信号

3. **计算2日最高价差分**:
   * `delta_high_2 = high_today - high_2_days_ago`
   * `delta_high_2 = 103.45 - 102.17 = 1.28`

4. **生成Alpha信号**:
   * 由于条件成立，计算 `-1 * delta_high_2`
   * `alpha23 = -1 * 1.28 = -1.28`

这个示例展示了一个典型的信号生成过程：
- 当价格突破20日移动平均时（`103.45 > 102.9635`）
- 且最近两日价格在上升（`delta_high_2`为正）
- 生成了一个负向信号（`-1.28`）
- 这表明策略预期价格可能会回落

## 数据需求

- `date`: 交易日期 (YYYY-MM-DD)
- `asset_id`: 资产ID
- `high`: 每日最高价

## 输出格式

输出的 CSV 文件 (`alpha23_results.csv`) 包含以下列：

- `date`: 交易日期
- `asset_id`: 资产ID
- `high`: 当日最高价（原始数据）
- `high_ma_20`: 20日最高价移动平均（中间计算值，保留四位小数）
- `delta_high_2`: 2日最高价差分（中间计算值）
- `alpha23`: 计算得到的 Alpha#23 值，保留两位有效数字

## 注意事项与风险提示

1. **数据窗口要求**:
   - 需要至少20天的历史数据来计算移动平均
   - 需要至少2天的历史数据来计算差分
   - 每个资产序列的前19个Alpha值将为NaN

2. **信号特点**:
   - 只在价格突破移动平均时产生信号
   - 信号强度取决于近期价格变动幅度
   - 适合捕捉价格突破后的反转机会

3. **潜在风险**:
   - 在震荡市场中可能产生过多假信号
   - 对于长期趋势行情可能错过部分机会
   - 需要结合其他指标来过滤信号

4. **实践建议**:
   - 考虑添加信号过滤条件（如成交量确认）
   - 可以调整移动平均和差分的时间窗口
   - 建议进行充分的回测验证
